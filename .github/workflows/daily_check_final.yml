# .github/workflows/daily_check_final.yml
name: ğŸ“Š Daily Check (Organization)

on:
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰
  schedule:
    - cron: '0 15 * * *'  # ë§¤ì¼ í•œêµ­ì‹œê°„ ì˜¤í›„ 12ì‹œ (UTC 15ì‹œ)
    
jobs:
  check-daily-progress:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}  # Organization Secret ì‚¬ìš©
        fetch-depth: 0
      
    - name: ğŸ Python ì„¤ì •
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: ğŸ”§ Git ì„¤ì •
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
    - name: ğŸ” í™˜ê²½ ë° êµ¬ì¡° í™•ì¸
      run: |
        echo "ğŸ“‚ í˜„ì¬ ë””ë ‰í† ë¦¬: $(pwd)"
        echo "ğŸ“ ë£¨íŠ¸ íŒŒì¼ ëª©ë¡:"
        ls -la
        echo ""
        echo "ğŸ“„ README íŒŒì¼ë“¤:"
        find . -name "README.md" 2>/dev/null || echo "README íŒŒì¼ ì—†ìŒ"
        echo ""
        echo "ğŸ“ ì£¼ì°¨ í´ë” êµ¬ì¡°:"
        ls -la "8ì›”3ì£¼ì°¨/" 2>/dev/null || echo "8ì›”3ì£¼ì°¨ í´ë” ì—†ìŒ"
        echo ""
        echo "ğŸ“… ë‚ ì§œ í´ë” êµ¬ì¡°:"
        ls -la "8ì›”3ì£¼ì°¨/0821/" 2>/dev/null || echo "0821 í´ë” ì—†ìŒ"
        ls -la "8ì›”3ì£¼ì°¨/0820/" 2>/dev/null || echo "0820 í´ë” ì—†ìŒ"
        echo ""
        echo "ğŸ—‚ï¸ ë¬¸ì œ í´ë”ë“¤:"
        find "8ì›”3ì£¼ì°¨/" -type d -name "BOJ_*" 2>/dev/null || echo "BOJ ë¬¸ì œ í´ë” ì—†ìŒ"
        find "8ì›”3ì£¼ì°¨/" -type d -name "SWEA_*" 2>/dev/null || echo "SWEA ë¬¸ì œ í´ë” ì—†ìŒ"
        echo ""
        echo "ğŸ“ Python íŒŒì¼ë“¤:"
        find "8ì›”3ì£¼ì°¨/" -name "*.py" 2>/dev/null || echo "Python íŒŒì¼ ì—†ìŒ"
        
    - name: ğŸ“Š ì¼ì¼ ì§„í–‰ìƒí™© ì²´í¬
      run: |
        echo "ğŸš€ ì¼ì¼ ì•Œê³ ë¦¬ì¦˜ ìŠ¤í„°ë”” ì²´í¬ ì‹œì‘!"
        python scripts/daily_check.py
        
    - name: ğŸ“ˆ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
      run: |
        echo "ğŸ“ˆ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ ì‹œì‘!"
        python scripts/update_progress.py
        
    - name: ğŸ” ì‹¤í–‰ í›„ ìƒì„¸ í™•ì¸
      run: |
        echo "ğŸ” ì‹¤í–‰ í›„ ìƒíƒœ í™•ì¸"
        git status
        echo ""
        echo "ğŸ“Š ìƒì„±ëœ ë¡œê·¸:"
        ls -la logs/ 2>/dev/null || echo "ë¡œê·¸ í´ë” ì—†ìŒ"
        echo ""
        echo "ğŸ“‹ ë¡œê·¸ ë‚´ìš© ë¯¸ë¦¬ë³´ê¸°:"
        TODAY=$(date +%Y%m%d)
        if [ -f "logs/daily_log_${TODAY}.json" ]; then
          echo "=== ì˜¤ëŠ˜ì˜ ì¼ì¼ ë¡œê·¸ ==="
          head -20 "logs/daily_log_${TODAY}.json"
        fi
        echo ""
        if [ -f "logs/progress_log_${TODAY}.json" ]; then
          echo "=== ì˜¤ëŠ˜ì˜ ì§„í–‰ë¥  ë¡œê·¸ ==="
          head -20 "logs/progress_log_${TODAY}.json"
        fi
        
    - name: ğŸ’¾ ë³€ê²½ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ
      env:
        GITHUB_TOKEN: ${{ secrets.PERSONAL_ACCESS_TOKEN }}  # í™˜ê²½ë³€ìˆ˜ë¡œ í† í° ì„¤ì •
      run: |
        if [[ -n $(git status --porcelain) ]]; then
          echo "ğŸ“ ë³€ê²½ì‚¬í•­ ë°œê²¬ - ìë™ ì»¤ë°‹ ì§„í–‰"
          git add .
          git commit -m "ğŸ“Š ìë™ ì—…ë°ì´íŠ¸: $(date +'%Y-%m-%d %H:%M') - Organization í†µí•© ê´€ë¦¬"
          git push origin master
          echo "âœ… í‘¸ì‹œ ì™„ë£Œ!"
        else
          echo "â„¹ï¸ ë³€ê²½ì‚¬í•­ ì—†ìŒ - ì»¤ë°‹í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤"
        fi

    - name: ğŸ“Š ê²°ê³¼ ìš”ì•½
      run: |
        echo "ğŸ‰ GitHub Actions ì‹¤í–‰ ì™„ë£Œ!"
        echo "ğŸ¢ Organization: about-algorithm-study"
        echo "ğŸ“ˆ ìŠ¤í„°ë”” ë©¤ë²„: ê¹€ê°•ì—°, ì‹ ì¬í˜, ì˜¤ì°½ë¯¼, ì†¡ë¯¼ê²½, ìµœì¬ê°"
        echo "ğŸ“ íŒŒì¼ êµ¬ì¡°: 8ì›”3ì£¼ì°¨/ë‚ ì§œ/ë¬¸ì œí´ë”/íŒŒì¼ëª….py"
        echo "ğŸ¤– ìë™í™”: ì¼ì¼ ì²´í¬ + ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ + Organization ë™ê¸°í™”"
        echo "ğŸ”— ê²°ê³¼ í™•ì¸: https://github.com/about-algorithm-study/About_Algorithm_Study"
# .github/workflows/daily_check.yml
name: ğŸ“Š Daily Algorithm Study Check

on:
  # ìë™ ìŠ¤ì¼€ì¤„ ì„ì‹œ ë¹„í™œì„±í™” (ì¶©ëŒ í•´ê²°ì„ ìœ„í•´)
  # schedule:
  #   - cron: '0 12 * * *'  # ì„ì‹œ ë¹„í™œì„±í™”
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ë§Œ ê°€ëŠ¥
    
jobs:
  check-daily-progress:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ ë ˆí¬ì§€í† ë¦¬ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        token: ${{ secrets.GITHUB_TOKEN }}
      
    - name: ğŸ Python ì„¤ì •
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: ğŸ”§ Git ì„¤ì •
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
    - name: ğŸ”„ ì•ˆì „í•œ ë™ê¸°í™”
      run: |
        echo "ğŸ“¡ ì›ê²© ì €ì¥ì†Œì™€ ë™ê¸°í™” ì¤‘..."
        
        # ì›ê²© ìµœì‹  ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        git fetch origin master
        
        # í˜„ì¬ ìƒíƒœ í™•ì¸
        echo "ğŸ” í˜„ì¬ Git ìƒíƒœ:"
        git status
        
        # ì›ê²©ê³¼ ì°¨ì´ê°€ ìˆëŠ”ì§€ í™•ì¸
        LOCAL=$(git rev-parse HEAD)
        REMOTE=$(git rev-parse origin/master)
        
        if [ "$LOCAL" != "$REMOTE" ]; then
          echo "âš ï¸  ì›ê²©ê³¼ ì°¨ì´ ë°œê²¬, ë™ê¸°í™” í•„ìš”"
          git reset --hard origin/master
          echo "âœ… ì›ê²©ê³¼ ë™ê¸°í™” ì™„ë£Œ"
        else
          echo "âœ… ì´ë¯¸ ìµœì‹  ìƒíƒœ"
        fi
        
    - name: ğŸ“Š ì¼ì¼ ì§„í–‰ìƒí™© ì²´í¬
      run: |
        echo "ğŸš€ ì¼ì¼ ì•Œê³ ë¦¬ì¦˜ ìŠ¤í„°ë”” ì²´í¬ ì‹œì‘!"
        python scripts/daily_check.py || echo "âš ï¸  ì¼ì¼ ì²´í¬ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ"
        
    - name: ğŸ“ˆ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
      run: |
        echo "ğŸ“ˆ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ ì‹œì‘!"
        python scripts/update_progress.py || echo "âš ï¸  ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ"
        
    - name: ğŸ’¾ ì•ˆì „í•œ ì»¤ë°‹ ë° í‘¸ì‹œ
      run: |
        echo "ğŸ’¾ ë³€ê²½ì‚¬í•­ í™•ì¸ ë° ì»¤ë°‹..."
        
        # ë³€ê²½ì‚¬í•­ í™•ì¸
        if [[ -n $(git status --porcelain) ]]; then
          echo "ğŸ“ ë³€ê²½ì‚¬í•­ ë°œê²¬:"
          git status --short
          
          # ë³€ê²½ì‚¬í•­ ìŠ¤í…Œì´ì§•
          git add .
          
          # ì»¤ë°‹
          commit_message="ğŸ“Š ìë™ ì—…ë°ì´íŠ¸: $(date +'%Y-%m-%d %H:%M') ì§„í–‰ìƒí™©"
          git commit -m "$commit_message"
          
          # í‘¸ì‹œ ì „ í•œ ë²ˆ ë” ë™ê¸°í™” í™•ì¸
          echo "ğŸ”„ í‘¸ì‹œ ì „ ìµœì¢… ë™ê¸°í™” í™•ì¸"
          git fetch origin master
          
          LOCAL=$(git rev-parse HEAD^)  # ì»¤ë°‹ ì „ ìƒíƒœ
          REMOTE=$(git rev-parse origin/master)
          
          if [ "$LOCAL" = "$REMOTE" ]; then
            echo "âœ… ì•ˆì „í•˜ê²Œ í‘¸ì‹œ ê°€ëŠ¥"
            git push origin master
            echo "âœ… í‘¸ì‹œ ì„±ê³µ!"
          else
            echo "âš ï¸  ì›ê²©ì— ìƒˆë¡œìš´ ë³€ê²½ì‚¬í•­ì´ ìˆìŒ, ë³‘í•© í›„ í‘¸ì‹œ"
            
            # í˜„ì¬ ì»¤ë°‹ì„ ì„ì‹œ ì €ì¥
            CURRENT_COMMIT=$(git rev-parse HEAD)
            
            # ì›ê²©ê³¼ ë³‘í•©
            git reset --hard origin/master
            git cherry-pick $CURRENT_COMMIT
            
            # ë‹¤ì‹œ í‘¸ì‹œ ì‹œë„
            git push origin master
            echo "âœ… ë³‘í•© í›„ í‘¸ì‹œ ì„±ê³µ!"
          fi
          
        else
          echo "â„¹ï¸  ì—…ë°ì´íŠ¸í•  ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."
        fi
        
    - name: ğŸ“‹ ì‹¤í–‰ ê²°ê³¼ ìš”ì•½
      if: always()
      run: |
        echo "ğŸ“‹ ì‹¤í–‰ ê²°ê³¼ ìš”ì•½:"
        today=$(date +'%Y%m%d')
        echo "- ì¼ì¼ ì²´í¬: $([ -f "logs/daily_log_${today}.json" ] && echo 'âœ… ì™„ë£Œ' || echo 'âŒ ì‹¤íŒ¨')"
        echo "- ì§„í–‰ë¥  ì—…ë°ì´íŠ¸: $([ -f "logs/progress_log_${today}.json" ] && echo 'âœ… ì™„ë£Œ' || echo 'âŒ ì‹¤íŒ¨')"
        echo "- ìµœê·¼ ì»¤ë°‹: $(git log --oneline -1)"
        echo "âœ… ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì™„ë£Œ"